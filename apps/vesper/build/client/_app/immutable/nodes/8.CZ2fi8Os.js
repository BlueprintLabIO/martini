import{c as S,a as v,d as q,f as g}from"../chunks/x7DbN4b3.js";import{f as R,p as B,o as J,t as _,a as K,$ as Q,s as m,c as r,r as o,g as u,b as y,d as n,n as V}from"../chunks/B9AHJbAJ.js";import{s as w}from"../chunks/CDGviZC4.js";import{i as C}from"../chunks/CU3yTzfR.js";import{h as X}from"../chunks/B0HB8HGj.js";import{b as Z}from"../chunks/E779tUjU.js";import{U as $}from"../chunks/Dx6R6Nmx.js";import{C as ee}from"../chunks/CgSNCr3d.js";import"../chunks/B5wtrm-B.js";import{I as ae,s as te}from"../chunks/C-4hCRPg.js";import{l as se,s as re}from"../chunks/DG4T_AN_.js";function oe(j,t){const p=se(t,["children","$$slots","$$events","$$legacy"]);const l=[["path",{d:"M12 2v4"}],["path",{d:"m16.2 7.8 2.9-2.9"}],["path",{d:"M18 12h4"}],["path",{d:"m16.2 16.2 2.9 2.9"}],["path",{d:"M12 18v4"}],["path",{d:"m4.9 19.1 2.9-2.9"}],["path",{d:"M2 12h4"}],["path",{d:"m4.9 4.9 2.9 2.9"}]];ae(j,re({name:"loader"},()=>p,{get iconNode(){return l},children:(f,G)=>{var x=S(),b=R(x);te(b,t,"default",{}),v(f,x)},$$slots:{default:!0}}))}var de=g('<span class="rounded bg-yellow-600/20 px-2 py-0.5 text-yellow-400">Testing Mode</span>'),ie=g("<span> </span>"),ne=g('<span>â€¢</span> <span class="flex items-center gap-1"><!> </span>',1),le=g('<div class="absolute inset-0 flex items-center justify-center bg-black/90 p-6"><div class="max-w-md text-center"><!> <h4 class="mb-2 text-lg font-bold text-white">Game Error</h4> <p class="mb-4 font-mono text-sm text-red-300"> </p> <button class="rounded bg-blue-600 px-4 py-2 text-sm text-white hover:bg-blue-700">Retry</button></div></div>'),ce=g('<div class="absolute inset-0 flex items-center justify-center bg-black/50"><div class="text-center"><!> <p class="text-white">Loading game...</p></div></div>'),me=g('<div class="flex h-screen flex-col bg-gray-900"><header class="flex items-center justify-between border-b border-gray-700 bg-gray-800 px-6 py-4"><div><h1 class="text-xl font-bold text-white"> </h1> <div class="flex items-center gap-2 text-sm text-gray-400"><!> <!></div></div></header> <div class="relative flex-1"><!> <iframe src="/sandbox-runtime.html" sandbox="allow-scripts" title="Game" class="h-full w-full border-0"></iframe></div></div>');function Ce(j,t){B(t,!0);let p=y(null),l=y(null),f=y(!1),G=y(!1);async function x(){n(f,!0),n(l,null);try{const[e,a]=await Promise.all([fetch(`/api/play/${t.data.project.shareCode}/bundle`),fetch(`/api/play/${t.data.project.shareCode}/assets`)]);if(!e.ok){const c=await e.json();throw new Error(c.details||c.error||"Failed to load game")}const{code:s}=await e.json();let i=[];a.ok&&(i=(await a.json()).assets||[]);const d=t.data.roomCode?`room-${t.data.roomCode}`:t.data.project.shareCode;u(p)?.contentWindow&&u(p).contentWindow.postMessage({type:"LOAD_CODE",payload:{code:s,roomId:d,isHost:!1,assets:i}},"*")}catch(e){n(l,{message:e instanceof Error?e.message:String(e)},!0),n(f,!1)}}function b(e){if(!e.data?.type)return;const{type:a,payload:s}=e.data;switch(a){case"READY":console.log("[Play] Game ready"),n(G,!0),n(f,!1),n(l,null);break;case"ERROR":n(l,s,!0),n(f,!1);break}}J(()=>(window.addEventListener("message",b),t.data.roomCode&&x(),()=>{window.removeEventListener("message",b)}));var E=me();X("1a8ll76",e=>{_(()=>{Q.title=`${t.data.project.name??""} - Play`},void 0,void 0,void 0,!0)});var M=r(E),L=r(M),k=r(L),A=r(k,!0);o(k);var D=m(k,2),P=r(D);{var H=e=>{var a=de();v(e,a)},N=e=>{var a=ie(),s=r(a);o(a),_(()=>w(s,`Share Code: ${t.data.project.shareCode??""}`)),v(e,a)};C(P,e=>{t.data.isTestingMode?e(H):e(N,!1)})}var T=m(P,2);{var U=e=>{var a=ne(),s=m(R(a),2),i=r(s);$(i,{class:"h-3 w-3"});var d=m(i);o(s),_(()=>w(d,` Multiplayer Room: ${t.data.roomCode??""}`)),v(e,a)};C(T,e=>{t.data.roomCode&&e(U)})}o(D),o(L),o(M);var I=m(M,2),O=r(I);{var W=e=>{var a=le(),s=r(a),i=r(s);ee(i,{class:"mx-auto mb-4 h-12 w-12 text-red-500"});var d=m(i,4),h=r(d,!0);o(d);var c=m(d,2);c.__click=x,o(s),o(a),_(()=>w(h,u(l).message)),v(e,a)},z=e=>{var a=S(),s=R(a);{var i=d=>{var h=ce(),c=r(h),Y=r(c);oe(Y,{class:"mx-auto mb-3 h-8 w-8 animate-spin text-white"}),V(2),o(c),o(h),v(d,h)};C(s,d=>{u(f)&&d(i)},!0)}v(e,a)};C(O,e=>{u(l)?e(W):e(z,!1)})}var F=m(O,2);Z(F,e=>n(p,e),()=>u(p)),o(I),o(E),_(()=>w(A,t.data.project.name)),v(j,E),K()}q(["click"]);export{Ce as component};
