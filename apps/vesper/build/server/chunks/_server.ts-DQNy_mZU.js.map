{"version":3,"file":"_server.ts-DQNy_mZU.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/starter-assets/_server.ts.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { createClient } from \"@supabase/supabase-js\";\nimport { P as PUBLIC_SUPABASE_URL } from \"../../../../chunks/public.js\";\nimport { a as SECRET_SUPABASE_SERVICE_ROLE_KEY } from \"../../../../chunks/private.js\";\nconst GET = async () => {\n  const supabase = createClient(PUBLIC_SUPABASE_URL, SECRET_SUPABASE_SERVICE_ROLE_KEY);\n  try {\n    const { data: files, error } = await supabase.storage.from(\"starter-assets\").list(\"\", {\n      limit: 1e3,\n      sortBy: { column: \"name\", order: \"asc\" }\n    });\n    if (error) {\n      return json({\n        error: \"Failed to fetch starter assets\",\n        details: error.message\n      }, { status: 500 });\n    }\n    const allFiles = [];\n    async function listDirectory(path) {\n      const { data: items, error: error2 } = await supabase.storage.from(\"starter-assets\").list(path, {\n        limit: 1e3,\n        sortBy: { column: \"name\", order: \"asc\" }\n      });\n      if (error2) {\n        return;\n      }\n      for (const item of items || []) {\n        const itemPath = path ? `${path}/${item.name}` : item.name;\n        if (item.name === \"metadata.json\") {\n          continue;\n        }\n        if (!item.metadata && item.name.indexOf(\".\") === -1) {\n          await listDirectory(itemPath);\n        } else if (item.metadata) {\n          allFiles.push({\n            name: item.name,\n            path: itemPath,\n            size: item.metadata.size || 0\n          });\n        }\n      }\n    }\n    await listDirectory(\"spritesheets\");\n    await listDirectory(\"sounds\");\n    const spritesheets = allFiles.filter((f) => f.path.startsWith(\"spritesheets/\") && f.name.match(/\\.(png|jpg|jpeg|gif|webp)$/i)).map((f) => {\n      const { data } = supabase.storage.from(\"starter-assets\").getPublicUrl(f.path);\n      return {\n        id: `starter-${f.path.replace(/[^a-zA-Z0-9]/g, \"-\")}`,\n        filename: f.name,\n        path: f.path,\n        fileType: \"image\",\n        assetType: \"spritesheet\",\n        sizeBytes: f.size,\n        url: data.publicUrl,\n        isStarter: true\n      };\n    });\n    const sounds = allFiles.filter((f) => f.path.startsWith(\"sounds/\") && f.name.match(/\\.(mp3|wav|ogg|m4a)$/i)).map((f) => {\n      const { data } = supabase.storage.from(\"starter-assets\").getPublicUrl(f.path);\n      return {\n        id: `starter-${f.path.replace(/[^a-zA-Z0-9]/g, \"-\")}`,\n        filename: f.name,\n        path: f.path,\n        fileType: \"audio\",\n        assetType: \"audio\",\n        sizeBytes: f.size,\n        url: data.publicUrl,\n        isStarter: true\n      };\n    });\n    return json({\n      assets: {\n        spritesheets,\n        sounds,\n        total: spritesheets.length + sounds.length\n      }\n    });\n  } catch (error) {\n    console.error(\"Unexpected error fetching starter assets:\", error);\n    return json(\n      {\n        error: \"Failed to fetch starter assets\",\n        details: error instanceof Error ? error.message : \"Unknown error\"\n      },\n      { status: 500 }\n    );\n  }\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":"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"}