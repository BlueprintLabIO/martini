{"version":3,"file":"index3-Cd3ryqyN.js","sources":["../../../.svelte-kit/adapter-node/chunks/index3.js"],"sourcesContent":["import { drizzle } from \"drizzle-orm/postgres-js\";\nimport postgres from \"postgres\";\nimport { pgTable, timestamp, text, uuid, unique, boolean, jsonb, integer } from \"drizzle-orm/pg-core\";\nimport { b as private_env } from \"./shared-server.js\";\nconst projects = pgTable(\"projects\", {\n  id: uuid(\"id\").defaultRandom().primaryKey(),\n  userId: uuid(\"user_id\").notNull(),\n  // References auth.users.id from Supabase\n  name: text(\"name\").notNull(),\n  shareCode: text(\"share_code\").unique(),\n  // 6-digit multiplayer share code\n  state: text(\"state\").default(\"draft\"),\n  // 'draft' | 'published'\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull()\n});\nconst files = pgTable(\"files\", {\n  id: uuid(\"id\").defaultRandom().primaryKey(),\n  projectId: uuid(\"project_id\").notNull().references(() => projects.id, { onDelete: \"cascade\" }),\n  path: text(\"path\").notNull(),\n  // '/src/scenes/GameScene.js'\n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull()\n}, (table) => ({\n  uniquePath: unique().on(table.projectId, table.path)\n}));\nconst conversations = pgTable(\"conversations\", {\n  id: uuid(\"id\").defaultRandom().primaryKey(),\n  projectId: uuid(\"project_id\").notNull().references(() => projects.id, { onDelete: \"cascade\" }),\n  title: text(\"title\").notNull(),\n  // Auto-generated or user-set (e.g., \"Add jump feature\")\n  isArchived: boolean(\"is_archived\").default(false).notNull(),\n  // Soft delete\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull()\n});\nconst chatMessages = pgTable(\"chat_messages\", {\n  id: uuid(\"id\").defaultRandom().primaryKey(),\n  conversationId: uuid(\"conversation_id\").notNull().references(() => conversations.id, { onDelete: \"cascade\" }),\n  messages: jsonb(\"messages\").notNull().default(\"[]\"),\n  // UIMessage[] from @ai-sdk/svelte\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull()\n}, (table) => ({\n  // One messages row per conversation (stores entire message array)\n  uniqueConversation: unique().on(table.conversationId)\n}));\nconst assets = pgTable(\"assets\", {\n  id: uuid(\"id\").defaultRandom().primaryKey(),\n  projectId: uuid(\"project_id\").notNull().references(() => projects.id, { onDelete: \"cascade\" }),\n  filename: text(\"filename\").notNull(),\n  // 'player.png', 'jump.mp3'\n  storagePath: text(\"storage_path\").notNull(),\n  // Supabase Storage path: 'project-assets/{projectId}/{filename}'\n  fileType: text(\"file_type\").notNull(),\n  // 'image' | 'audio'\n  assetType: text(\"asset_type\").notNull(),\n  // 'image' | 'audio' | 'spritesheet' | 'atlas' (future expansion)\n  sizeBytes: integer(\"size_bytes\").notNull(),\n  // File size for quota tracking\n  metadata: jsonb(\"metadata\"),\n  // Optional: { width, height, frameWidth, frameHeight, duration, ... }\n  createdAt: timestamp(\"created_at\").defaultNow().notNull()\n});\nconst schema = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({\n  __proto__: null,\n  assets,\n  chatMessages,\n  conversations,\n  files,\n  projects\n}, Symbol.toStringTag, { value: \"Module\" }));\nif (!private_env.SECRET_DATABASE_URL) throw new Error(\"SECRET_DATABASE_URL is not set\");\nconst client = postgres(private_env.SECRET_DATABASE_URL);\nconst db = drizzle(client, { schema });\nexport {\n  assets as a,\n  chatMessages as b,\n  conversations as c,\n  db as d,\n  files as f,\n  projects as p\n};\n"],"names":[],"mappings":"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"}