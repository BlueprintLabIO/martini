{"version":3,"file":"bundler-CtkqweLb.js","sources":["../../../.svelte-kit/adapter-node/chunks/bundler.js"],"sourcesContent":["import * as esbuild from \"esbuild\";\nasync function bundleProjectFiles(sourceFiles) {\n  if (sourceFiles.length === 0) {\n    return { success: false, error: \"No source files found in /src/\" };\n  }\n  const entryFile = sourceFiles.find((f) => f.path === \"/src/main.ts\" || f.path === \"/src/main.js\");\n  if (!entryFile) {\n    return { success: false, error: \"Entry point /src/main.ts or /src/main.js not found\" };\n  }\n  try {\n    const fileMap = /* @__PURE__ */ new Map();\n    sourceFiles.forEach((file) => {\n      const path = file.path.startsWith(\"/\") ? file.path.slice(1) : file.path;\n      fileMap.set(path, file.content);\n    });\n    const virtualPlugin = {\n      name: \"virtual-files\",\n      setup(build) {\n        build.onResolve({ filter: /^@martini\\/(phaser|core)$/ }, (args) => {\n          return { path: args.path, namespace: \"martini-global\" };\n        });\n        build.onLoad({ filter: /.*/, namespace: \"martini-global\" }, (args) => {\n          return {\n            contents: `\n\t\t\t\t\t\t\texport const defineGame = window.MartiniMultiplayer.defineGame;\n\t\t\t\t\t\t\texport const GameRuntime = window.MartiniMultiplayer.GameRuntime;\n\t\t\t\t\t\t\texport const PhaserAdapter = window.MartiniMultiplayer.PhaserAdapter;\n\t\t\t\t\t\t\texport const TrysteroTransport = window.MartiniMultiplayer.TrysteroTransport;\n\t\t\t\t\t\t`,\n            loader: \"js\"\n          };\n        });\n        build.onResolve({ filter: /^phaser$/ }, (args) => {\n          return { path: args.path, namespace: \"phaser-global\" };\n        });\n        build.onLoad({ filter: /.*/, namespace: \"phaser-global\" }, () => {\n          return {\n            contents: \"export default window.Phaser;\",\n            loader: \"js\"\n          };\n        });\n        build.onResolve({ filter: /.*/ }, (args) => {\n          if (args.path.startsWith(\"./\") || args.path.startsWith(\"../\")) {\n            const importerDir = args.importer.split(\"/\").slice(0, -1);\n            const pathParts = args.path.split(\"/\");\n            const resolvedParts = [...importerDir];\n            for (const part of pathParts) {\n              if (part === \"..\") {\n                resolvedParts.pop();\n              } else if (part === \".\") {\n                continue;\n              } else {\n                resolvedParts.push(part);\n              }\n            }\n            let resolved = resolvedParts.join(\"/\");\n            if (!resolved.endsWith(\".ts\") && !resolved.endsWith(\".js\")) {\n              if (fileMap.has(resolved + \".ts\")) {\n                resolved += \".ts\";\n              } else if (fileMap.has(resolved + \".js\")) {\n                resolved += \".js\";\n              }\n            }\n            return { path: resolved, namespace: \"virtual\" };\n          }\n          const normalizedPath = args.path.startsWith(\"/\") ? args.path.slice(1) : args.path;\n          return { path: normalizedPath, namespace: \"virtual\" };\n        });\n        build.onLoad({ filter: /.*/, namespace: \"virtual\" }, (args) => {\n          const content = fileMap.get(args.path);\n          if (!content) {\n            const availableFiles = Array.from(fileMap.keys()).join(\", \");\n            return {\n              errors: [\n                {\n                  text: `File not found: ${args.path}`,\n                  detail: `Available files: ${availableFiles}`\n                }\n              ]\n            };\n          }\n          return {\n            contents: content,\n            loader: args.path.endsWith(\".ts\") ? \"ts\" : \"js\"\n          };\n        });\n      }\n    };\n    const result = await esbuild.build({\n      stdin: {\n        contents: entryFile.content,\n        sourcefile: entryFile.path.startsWith(\"/\") ? entryFile.path.slice(1) : entryFile.path,\n        loader: entryFile.path.endsWith(\".ts\") ? \"ts\" : \"js\"\n      },\n      bundle: true,\n      format: \"iife\",\n      platform: \"browser\",\n      target: \"es2020\",\n      write: false,\n      plugins: [virtualPlugin],\n      minify: false,\n      // Keep readable for debugging\n      sourcemap: \"inline\"\n      // Enable source maps for better error messages\n    });\n    const bundledCode = result.outputFiles[0].text;\n    return {\n      success: true,\n      code: bundledCode\n    };\n  } catch (error) {\n    console.error(\"Bundling error:\", error);\n    return {\n      success: false,\n      error: \"Failed to bundle code\",\n      details: error instanceof Error ? error.message : String(error)\n    };\n  }\n}\nexport {\n  bundleProjectFiles as b\n};\n"],"names":[],"mappings":"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"}