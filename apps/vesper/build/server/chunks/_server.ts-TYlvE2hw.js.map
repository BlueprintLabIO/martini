{"version":3,"file":"_server.ts-TYlvE2hw.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/play/_shareCode_/bundle/_server.ts.js"],"sourcesContent":["import { error, json } from \"@sveltejs/kit\";\nimport { g as getProjectByShareCode } from \"../../../../../../chunks/shareCode.js\";\nimport { d as db, p as projects, f as files } from \"../../../../../../chunks/index3.js\";\nimport { eq } from \"drizzle-orm\";\nimport { b as bundleProjectFiles } from \"../../../../../../chunks/bundler.js\";\nconst GET = async ({ params }) => {\n  const { shareCode } = params;\n  let project;\n  const isUUID = shareCode.length > 6 && shareCode.includes(\"-\");\n  if (isUUID) {\n    const result2 = await db.select().from(projects).where(eq(projects.id, shareCode)).limit(1);\n    if (result2.length === 0) {\n      throw error(404, \"Game not found\");\n    }\n    project = result2[0];\n  } else {\n    project = await getProjectByShareCode(shareCode.toUpperCase());\n    if (!project) {\n      throw error(404, \"Game not found\");\n    }\n    if (project.state !== \"published\" || !project.shareCode) {\n      throw error(404, \"Game not available\");\n    }\n  }\n  const projectFiles = await db.select().from(files).where(eq(files.projectId, project.id));\n  const sourceFiles = projectFiles.filter((f) => (f.path.endsWith(\".ts\") || f.path.endsWith(\".js\")) && f.path.startsWith(\"/src/\")).map((f) => ({ path: f.path, content: f.content }));\n  const result = await bundleProjectFiles(sourceFiles);\n  if (!result.success) {\n    return json(\n      {\n        error: result.error,\n        details: result.details\n      },\n      { status: 500 }\n    );\n  }\n  return json({\n    success: true,\n    code: result.code\n  });\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;;;;;;;;;AAKK,MAAC,GAAG,GAAG,OAAO,EAAE,MAAM,EAAE,KAAK;AAClC,EAAE,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM;AAC9B,EAAE,IAAI,OAAO;AACb,EAAE,MAAM,MAAM,GAAG,SAAS,CAAC,MAAM,GAAG,CAAC,IAAI,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC;AAChE,EAAE,IAAI,MAAM,EAAE;AACd,IAAI,MAAM,OAAO,GAAG,MAAM,EAAE,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,EAAE,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;AAC/F,IAAI,IAAI,OAAO,CAAC,MAAM,KAAK,CAAC,EAAE;AAC9B,MAAM,MAAM,KAAK,CAAC,GAAG,EAAE,gBAAgB,CAAC;AACxC,IAAI;AACJ,IAAI,OAAO,GAAG,OAAO,CAAC,CAAC,CAAC;AACxB,EAAE,CAAC,MAAM;AACT,IAAI,OAAO,GAAG,MAAM,qBAAqB,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC;AAClE,IAAI,IAAI,CAAC,OAAO,EAAE;AAClB,MAAM,MAAM,KAAK,CAAC,GAAG,EAAE,gBAAgB,CAAC;AACxC,IAAI;AACJ,IAAI,IAAI,OAAO,CAAC,KAAK,KAAK,WAAW,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE;AAC7D,MAAM,MAAM,KAAK,CAAC,GAAG,EAAE,oBAAoB,CAAC;AAC5C,IAAI;AACJ,EAAE;AACF,EAAE,MAAM,YAAY,GAAG,MAAM,EAAE,CAAC,MAAM,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,SAAS,EAAE,OAAO,CAAC,EAAE,CAAC,CAAC;AAC3F,EAAE,MAAM,WAAW,GAAG,YAAY,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,EAAE,IAAI,EAAE,CAAC,CAAC,IAAI,EAAE,OAAO,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC;AACrL,EAAE,MAAM,MAAM,GAAG,MAAM,kBAAkB,CAAC,WAAW,CAAC;AACtD,EAAE,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE;AACvB,IAAI,OAAO,IAAI;AACf,MAAM;AACN,QAAQ,KAAK,EAAE,MAAM,CAAC,KAAK;AAC3B,QAAQ,OAAO,EAAE,MAAM,CAAC;AACxB,OAAO;AACP,MAAM,EAAE,MAAM,EAAE,GAAG;AACnB,KAAK;AACL,EAAE;AACF,EAAE,OAAO,IAAI,CAAC;AACd,IAAI,OAAO,EAAE,IAAI;AACjB,IAAI,IAAI,EAAE,MAAM,CAAC;AACjB,GAAG,CAAC;AACJ;;;;"}