{"version":3,"file":"_server.ts-C4muE3VH.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/conversations/_id_/_server.ts.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { d as db, p as projects, c as conversations } from \"../../../../../chunks/index3.js\";\nimport { eq } from \"drizzle-orm\";\nconst PATCH = async ({ params, locals, request }) => {\n  const { session, user } = await locals.safeGetSession();\n  if (!session || !user) {\n    return json({ error: \"Unauthorized\" }, { status: 401 });\n  }\n  const conversationId = params.id;\n  const body = await request.json();\n  const { title, isArchived } = body;\n  const [conversation] = await db.select({\n    conversation: conversations,\n    project: projects\n  }).from(conversations).innerJoin(projects, eq(conversations.projectId, projects.id)).where(eq(conversations.id, conversationId)).limit(1);\n  if (!conversation) {\n    return json({ error: \"Conversation not found\" }, { status: 404 });\n  }\n  if (conversation.project.userId !== user.id) {\n    return json({ error: \"Unauthorized\" }, { status: 403 });\n  }\n  const updates = {\n    updatedAt: /* @__PURE__ */ new Date()\n  };\n  if (title !== void 0 && typeof title === \"string\") {\n    updates.title = title.trim();\n  }\n  if (isArchived !== void 0 && typeof isArchived === \"boolean\") {\n    updates.isArchived = isArchived;\n  }\n  const [updated] = await db.update(conversations).set(updates).where(eq(conversations.id, conversationId)).returning();\n  return json({\n    conversation: updated\n  });\n};\nconst DELETE = async ({ params, locals }) => {\n  const { session, user } = await locals.safeGetSession();\n  if (!session || !user) {\n    return json({ error: \"Unauthorized\" }, { status: 401 });\n  }\n  const conversationId = params.id;\n  const [conversation] = await db.select({\n    conversation: conversations,\n    project: projects\n  }).from(conversations).innerJoin(projects, eq(conversations.projectId, projects.id)).where(eq(conversations.id, conversationId)).limit(1);\n  if (!conversation) {\n    return json({ error: \"Conversation not found\" }, { status: 404 });\n  }\n  if (conversation.project.userId !== user.id) {\n    return json({ error: \"Unauthorized\" }, { status: 403 });\n  }\n  await db.delete(conversations).where(eq(conversations.id, conversationId));\n  return json({ success: true });\n};\nexport {\n  DELETE,\n  PATCH\n};\n"],"names":[],"mappings":";;;;;;;;AAGK,MAAC,KAAK,GAAG,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK;AACrD,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,MAAM,MAAM,CAAC,cAAc,EAAE;AACzD,EAAE,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,EAAE;AACzB,IAAI,OAAO,IAAI,CAAC,EAAE,KAAK,EAAE,cAAc,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC3D,EAAE;AACF,EAAE,MAAM,cAAc,GAAG,MAAM,CAAC,EAAE;AAClC,EAAE,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE;AACnC,EAAE,MAAM,EAAE,KAAK,EAAE,UAAU,EAAE,GAAG,IAAI;AACpC,EAAE,MAAM,CAAC,YAAY,CAAC,GAAG,MAAM,EAAE,CAAC,MAAM,CAAC;AACzC,IAAI,YAAY,EAAE,aAAa;AAC/B,IAAI,OAAO,EAAE;AACb,GAAG,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,SAAS,CAAC,QAAQ,EAAE,EAAE,CAAC,aAAa,CAAC,SAAS,EAAE,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,aAAa,CAAC,EAAE,EAAE,cAAc,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;AAC3I,EAAE,IAAI,CAAC,YAAY,EAAE;AACrB,IAAI,OAAO,IAAI,CAAC,EAAE,KAAK,EAAE,wBAAwB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACrE,EAAE;AACF,EAAE,IAAI,YAAY,CAAC,OAAO,CAAC,MAAM,KAAK,IAAI,CAAC,EAAE,EAAE;AAC/C,IAAI,OAAO,IAAI,CAAC,EAAE,KAAK,EAAE,cAAc,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC3D,EAAE;AACF,EAAE,MAAM,OAAO,GAAG;AAClB,IAAI,SAAS,kBAAkB,IAAI,IAAI;AACvC,GAAG;AACH,EAAE,IAAI,KAAK,KAAK,MAAM,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE;AACrD,IAAI,OAAO,CAAC,KAAK,GAAG,KAAK,CAAC,IAAI,EAAE;AAChC,EAAE;AACF,EAAE,IAAI,UAAU,KAAK,MAAM,IAAI,OAAO,UAAU,KAAK,SAAS,EAAE;AAChE,IAAI,OAAO,CAAC,UAAU,GAAG,UAAU;AACnC,EAAE;AACF,EAAE,MAAM,CAAC,OAAO,CAAC,GAAG,MAAM,EAAE,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,aAAa,CAAC,EAAE,EAAE,cAAc,CAAC,CAAC,CAAC,SAAS,EAAE;AACvH,EAAE,OAAO,IAAI,CAAC;AACd,IAAI,YAAY,EAAE;AAClB,GAAG,CAAC;AACJ;AACK,MAAC,MAAM,GAAG,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,KAAK;AAC7C,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,MAAM,MAAM,CAAC,cAAc,EAAE;AACzD,EAAE,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,EAAE;AACzB,IAAI,OAAO,IAAI,CAAC,EAAE,KAAK,EAAE,cAAc,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC3D,EAAE;AACF,EAAE,MAAM,cAAc,GAAG,MAAM,CAAC,EAAE;AAClC,EAAE,MAAM,CAAC,YAAY,CAAC,GAAG,MAAM,EAAE,CAAC,MAAM,CAAC;AACzC,IAAI,YAAY,EAAE,aAAa;AAC/B,IAAI,OAAO,EAAE;AACb,GAAG,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,SAAS,CAAC,QAAQ,EAAE,EAAE,CAAC,aAAa,CAAC,SAAS,EAAE,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,aAAa,CAAC,EAAE,EAAE,cAAc,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;AAC3I,EAAE,IAAI,CAAC,YAAY,EAAE;AACrB,IAAI,OAAO,IAAI,CAAC,EAAE,KAAK,EAAE,wBAAwB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACrE,EAAE;AACF,EAAE,IAAI,YAAY,CAAC,OAAO,CAAC,MAAM,KAAK,IAAI,CAAC,EAAE,EAAE;AAC/C,IAAI,OAAO,IAAI,CAAC,EAAE,KAAK,EAAE,cAAc,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC3D,EAAE;AACF,EAAE,MAAM,EAAE,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,aAAa,CAAC,EAAE,EAAE,cAAc,CAAC,CAAC;AAC5E,EAAE,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;AAChC;;;;"}