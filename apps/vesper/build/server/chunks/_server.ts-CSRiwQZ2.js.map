{"version":3,"file":"_server.ts-CSRiwQZ2.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/chat/_server.ts.js"],"sourcesContent":["import { tool, zodSchema, streamText, stepCountIs, convertToModelMessages } from \"ai\";\nimport { createAnthropic } from \"@ai-sdk/anthropic\";\nimport { json } from \"@sveltejs/kit\";\nimport { d as db, f as files, p as projects, a as assets } from \"../../../../chunks/index3.js\";\nimport { eq, and } from \"drizzle-orm\";\nimport { S as SECRET_COMPLETION_KEY } from \"../../../../chunks/private.js\";\nimport { z } from \"zod\";\nimport crypto from \"crypto\";\nimport { g as getConsoleLogs } from \"../../../../chunks/game-console-output.js\";\nconst MARTINI_SDK_DOCS = `\n# Martini SDK - What Makes It Different\n\n## Core Architecture\n**Host-authoritative**: Host runs Phaser physics, clients ONLY render.\n**Auto-sync**: PhaserAdapter syncs state automatically via trackSprite().\n**Direct mutation**: state.x = 10 (NOT {...state, x: 10}).\n\n## Critical Implementation Patterns\n\n### 1. Host Creates Physics Objects, Client Creates Visual Objects\n\n**WITH TEXTURES (when assets available):**\n\\`\\`\\`typescript\n// Host\nif (isHost) {\n  const sprite = this.physics.add.sprite(100, 100, 'player');\n  sprite.body.setCollideWorldBounds(true);\n  this.physics.add.collider(sprite, platforms);\n  adapter.trackSprite(sprite, 'player-' + playerId);\n}\n\n// Client (CRITICAL - check state._sprites)\nif (!isHost) {\n  adapter.onChange((state) => {\n    if (!state._sprites) return; // REQUIRED CHECK!\n    for (const [key, data] of Object.entries(state._sprites)) {\n      if (!this.sprites[key]) {\n        const sprite = this.add.sprite(data.x, data.y, 'player');\n        this.sprites[key] = sprite;\n        adapter.registerRemoteSprite(key, sprite); // NOT trackSprite!\n      }\n    }\n  });\n}\n\\`\\`\\`\n\n**WITHOUT TEXTURES (shape-based games - COMMON PATTERN):**\n\\`\\`\\`typescript\n// Host - Rectangle with physics\nif (isHost) {\n  const rect = this.add.rectangle(100, 100, 32, 32, 0xff0000);\n  this.physics.add.existing(rect); // Add physics AFTER creating shape\n  rect.body.setCollideWorldBounds(true);\n  this.physics.add.collider(rect, platforms);\n  adapter.trackSprite(rect, 'player-' + playerId);\n}\n\n// Client - Same rectangle, NO physics\nif (!isHost) {\n  adapter.onChange((state) => {\n    if (!state._sprites) return;\n    for (const [key, data] of Object.entries(state._sprites)) {\n      if (!this.sprites[key]) {\n        const rect = this.add.rectangle(data.x, data.y, 32, 32, 0xff0000);\n        this.sprites[key] = rect;\n        adapter.registerRemoteSprite(key, rect);\n      }\n    }\n  });\n}\n\\`\\`\\`\n\n**PLATFORMS / STATIC OBJECTS:**\n\\`\\`\\`typescript\n// CORRECT - Visible platform\nconst plat = this.add.rectangle(400, 500, 200, 20, 0x34495e);\nthis.physics.add.existing(plat, true); // true = static\nplatforms.add(plat);\n\n// WRONG - Invisible (undefined texture)\nplatforms.create(400, 500, undefined); // DON'T DO THIS!\n\\`\\`\\`\n\n### 2. Input Storage Pattern\n\n**game.ts:**\n\\`\\`\\`typescript\nsetup: () => ({\n  players: {},\n  inputs: {} // Store inputs here\n}),\n\nactions: {\n  move: {\n    apply: (state, ctx, input) => {\n      if (!state.inputs) state.inputs = {}; // Safety check\n      state.inputs[ctx.targetId] = input;\n    }\n  }\n}\n\\`\\`\\`\n\n**scene.ts:**\n\\`\\`\\`typescript\nupdate() {\n  // Everyone submits input\n  runtime.submitAction('move', { left: true, right: false });\n\n  if (isHost) {\n    // Host reads inputs and applies physics\n    const state = runtime.getState();\n    for (const [pid, input] of Object.entries(state.inputs || {})) {\n      if (input.left) sprite.body.setVelocityX(-200);\n    }\n  }\n}\n\\`\\`\\`\n\n### 3. Client Interpolation (REQUIRED)\n\n\\`\\`\\`typescript\nupdate() {\n  if (!isHost) {\n    this.adapter.updateInterpolation(); // MUST call every frame!\n  }\n}\n\\`\\`\\`\n\n### 4. Player Join/Leave Hooks\n\n\\`\\`\\`typescript\ndefineGame({\n  onPlayerJoin: (state, playerId) => {\n    state.players[playerId] = { x: 100, y: 100 };\n  },\n  onPlayerLeave: (state, playerId) => {\n    delete state.players[playerId];\n  }\n});\n\\`\\`\\`\n\n**In scene (check existing peers for LocalTransport):**\n\\`\\`\\`typescript\nif (isHost) {\n  // CRITICAL: Check existing peers (LocalTransport connects instantly!)\n  transport.getPeerIds().forEach(peerId => createPeerSprite(peerId));\n\n  // Also listen for future joins\n  transport.onPeerJoin(peerId => createPeerSprite(peerId));\n}\n\\`\\`\\`\n\n### 5. Target Specific Players\n\n\\`\\`\\`typescript\n// Third argument = targetId\nruntime.submitAction('score', undefined, winnerId);\n// context.targetId will be winnerId\n\nactions: {\n  score: {\n    apply: (state, context) => {\n      state.players[context.targetId].score += 1;\n    }\n  }\n}\n\\`\\`\\`\n\n## Essential Checklist\n\nHost pattern:\n- [ ] Create physics object: \\`this.physics.add.sprite()\\` OR \\`this.add.rectangle() + this.physics.add.existing()\\`\n- [ ] \\`adapter.trackSprite(object, key)\\` once in create()\n- [ ] Host reads \\`state.inputs\\` to apply physics\n\nClient pattern:\n- [ ] Check \\`if (!state._sprites) return\\`\n- [ ] Create visual object (NO physics): \\`this.add.sprite()\\` OR \\`this.add.rectangle()\\`\n- [ ] \\`adapter.registerRemoteSprite(key, object)\\`\n- [ ] Call \\`adapter.updateInterpolation()\\` in update()\n\nBoth:\n- [ ] Store inputs: \\`state.inputs = {}\\`\n- [ ] Safety checks: \\`if (!state.inputs) state.inputs = {}\\`\n- [ ] Use \\`onPlayerJoin\\`/\\`onPlayerLeave\\` hooks\n\nShape-based games (no textures):\n- [ ] Use \\`this.add.rectangle()\\` or \\`this.add.circle()\\` NOT \\`sprite()\\`\n- [ ] Add physics AFTER: \\`this.physics.add.existing(shape)\\`\n- [ ] Platforms: create rectangle, then add to static group\n`;\nconst SYSTEM_PROMPT = `You help create multiplayer Phaser games with Martini SDK!\n\nDEFAULTS (don't ask):\n- Multiplayer (Martini SDK always)\n- 1 level to start\n- Basic shapes (rectangles/circles - no art until working)\n- 2-player cooperative\n\nBE CONCISE:\n- 1-2 sentences max, then code\n- Make smart assumptions\n- Act first, explain briefly after\n\nCRITICAL MARTINI PATTERNS:\n\n1. **Host = physics, Client = visual only**\n   Shapes: this.add.rectangle() + this.physics.add.existing() + adapter.trackSprite()\n   Sprites: this.physics.add.sprite() + adapter.trackSprite()\n   Client: Same shape/sprite (NO physics) + adapter.registerRemoteSprite()\n\n2. **Client MUST check state._sprites**\n   if (!state._sprites) return;\n\n3. **Client MUST call updateInterpolation()**\n   if (!isHost) adapter.updateInterpolation();\n\n4. **Store inputs in state**\n   state.inputs = {}; // In setup\n   state.inputs[ctx.targetId] = input; // In move action\n\n5. **Host reads inputs to apply physics**\n   for (const [pid, input] of Object.entries(state.inputs || {})) { ... }\n\n6. **NO TEXTURES = Use Shapes (Common!)**\n   Player: this.add.rectangle(x, y, 32, 32, 0xff0000)\n   Platform: this.add.rectangle(x, y, w, h, 0x888888)\n   Then: this.physics.add.existing(shape) to add physics\n\n---\n\n${MARTINI_SDK_DOCS}`;\nconst PLANNING_PROMPT = `You help plan game ideas!\n\nCreate markdown docs in /docs/:\n- game-concept.md - Vision\n- mechanics.md - Rules\n- levels.md - Design\n\nBe concise. Ask questions. Switch to Act mode to code.`;\nfunction buildSystemPrompt(projectFiles, projectAssets = [], planMode = false) {\n  const fileListSection = projectFiles.length > 0 ? `\n\nPROJECT FILES:\n${projectFiles.map((f) => f.path).join(\"\\n\")}` : \"\";\n  let assetSection = \"\";\n  if (projectAssets.length > 0) {\n    const images = projectAssets.filter((a) => a.fileType === \"image\");\n    const audio = projectAssets.filter((a) => a.fileType === \"audio\");\n    assetSection = \"\\n\\nASSETS:\";\n    if (images.length > 0) {\n      assetSection += \"\\nImages: \" + images.map((img) => {\n        const name = img.filename.replace(/\\.[^/.]+$/, \"\");\n        return `'${name}'`;\n      }).join(\", \");\n    }\n    if (audio.length > 0) {\n      assetSection += \"\\nAudio: \" + audio.map((snd) => {\n        const name = snd.filename.replace(/\\.[^/.]+$/, \"\");\n        return `'${name}'`;\n      }).join(\", \");\n    }\n    assetSection += \"\\n(Assets preloaded - just use names in code)\";\n  }\n  const basePrompt = planMode ? PLANNING_PROMPT : SYSTEM_PROMPT;\n  return basePrompt + fileListSection + assetSection;\n}\nfunction fastHash(content) {\n  const sample = content.slice(0, 1024) + // First 1KB\n  content.slice(-1024) + // Last 1KB\n  content.length;\n  return crypto.createHash(\"sha256\").update(sample).digest(\"hex\").slice(0, 16);\n}\nfunction createProjectTools(projectId, planMode = false) {\n  const commonTools = {\n    getConsoleLogs: tool({\n      description: \"Get recent console output from the game (errors, gameAPI.log() messages). Use this to see runtime errors and verify code execution.\",\n      inputSchema: zodSchema(\n        z.object({\n          limit: z.number().default(20).describe(\"Number of recent logs to return (default: 20)\")\n        })\n      ),\n      execute: async ({ limit }) => {\n        const logs = getConsoleLogs(projectId, limit);\n        if (logs.length === 0) {\n          return {\n            logs: [],\n            message: \"No console logs yet. Game may not be running or no logs have been generated.\",\n            hint: \"Ask user to run the game and try an action that should generate logs\"\n          };\n        }\n        return {\n          logs: logs.map((l) => `[Frame ${l.frame}] ${l.message}`),\n          total: logs.length\n        };\n      }\n    }),\n    readFile: tool({\n      description: \"Read the contents of a file in the project. Returns version token for safe editing.\",\n      inputSchema: zodSchema(\n        z.object({\n          path: z.string().describe(\"File path, e.g., /src/scenes/GameScene.js\")\n        })\n      ),\n      execute: async ({ path }) => {\n        const normalizedPath = path.startsWith(\"/\") ? path : `/${path}`;\n        const [file] = await db.select().from(files).where(and(eq(files.projectId, projectId), eq(files.path, normalizedPath))).limit(1);\n        if (!file) {\n          return {\n            error: \"File not found\",\n            path: normalizedPath,\n            hint: \"Use listFiles() to see available files\"\n          };\n        }\n        return {\n          path: file.path,\n          content: file.content,\n          version: fastHash(file.content),\n          lines: file.content.split(\"\\n\").length,\n          size: file.content.length\n        };\n      }\n    }),\n    listFiles: tool({\n      description: \"List all files in the project to see the structure\",\n      inputSchema: zodSchema(z.object({})),\n      execute: async () => {\n        const projectFiles = await db.select({\n          path: files.path,\n          updatedAt: files.updatedAt\n        }).from(files).where(eq(files.projectId, projectId));\n        return {\n          files: projectFiles.map((f) => ({\n            path: f.path,\n            name: f.path.split(\"/\").pop(),\n            folder: f.path.split(\"/\").slice(0, -1).join(\"/\") || \"/\"\n          })),\n          total: projectFiles.length\n        };\n      }\n    }),\n    createFile: tool({\n      description: \"Create a new file in the project. Can also be used to completely rewrite an existing file with new content. Use this for creating design docs, new game files, or when you need to replace an entire file.\",\n      inputSchema: zodSchema(\n        z.object({\n          path: z.string().describe(\n            \"File path starting with /, e.g., /docs/game-concept.md or /src/scenes/Level2.js\"\n          ),\n          content: z.string().describe(\"Content of the new file. IMPORTANT: Use actual newline characters (not escaped \\\\n sequences). Multi-line content should have real line breaks, not literal backslash-n.\")\n        })\n      ),\n      needsApproval: true\n      // üîë Require user approval for file creation\n      // ‚ö†Ô∏è NO execute function - client-side execution only!\n      //\n      // ARCHITECTURE: All mutation operations MUST run client-side\n      // Reasons for client-side file creation:\n      // 1. Client ownership - filesMap state is the source of truth\n      // 2. Instant reactivity - file tree updates immediately without fetch cycles\n      // 3. Race condition prevention - no DB write ‚Üí fetch ‚Üí refresh loops\n      // 4. CRDT/Y.js compatibility - future real-time collaboration requires client mutations\n      // 5. Optimistic UI - new file visible instantly, async server persistence\n      // 6. Consistent pattern - all mutations (create/edit/delete) work the same way\n    }),\n    captureScreenshot: tool({\n      description: \"Capture a screenshot of the game canvas. Use this to debug visual bugs, collision issues, or sprite positioning problems.\",\n      inputSchema: zodSchema(z.object({})),\n      needsApproval: false\n      // No approval needed - just captures current state\n      // ‚ö†Ô∏è NO execute function - client-side execution only!\n      // Screenshot capture must happen client-side to access the canvas element\n    })\n  };\n  return {\n    ...commonTools,\n    editFile: tool({\n      description: planMode ? \"Edit a design document in /docs folder. ALWAYS read the file first to get the version token. Only use for files in /docs/\" : \"Edit a file by replacing exact text. ALWAYS read the file first to get the version token.\",\n      inputSchema: zodSchema(\n        z.object({\n          path: z.string().describe(\"File path to edit\"),\n          version: z.string().describe(\"Version token from readFile (prevents conflicts)\"),\n          edits: z.array(\n            z.object({\n              old_text: z.string().describe(\"Exact text to replace\"),\n              new_text: z.string().describe(\"New text to insert\")\n            })\n          ).describe(\"Array of search/replace edits to apply sequentially\")\n        })\n      ),\n      needsApproval: true\n      // üîë Require user approval for file modifications\n      // ‚ö†Ô∏è NO execute function - client-side execution only!\n      // Reasons for client-side mutations:\n      // 1. Enables Y.js/CRDT integration - client must own document mutations\n      // 2. No race conditions - direct state updates, no fetch/refresh cycles\n      // 3. Optimistic UI - instant feedback, async server persistence\n      // 4. Version control ready - client tracks each edit operation\n      // 5. Future-proof for real-time collaboration\n    })\n  };\n}\nconst anthropic = createAnthropic({\n  apiKey: SECRET_COMPLETION_KEY\n});\nfunction getRecentMessagesByUserTurns(messages, userTurnCount = 5) {\n  if (messages.length === 0) return messages;\n  const userMessageIndices = [];\n  for (let i = 0; i < messages.length; i++) {\n    if (messages[i].role === \"user\") {\n      userMessageIndices.push(i);\n    }\n  }\n  if (userMessageIndices.length <= userTurnCount) {\n    return messages;\n  }\n  const startIndex = userMessageIndices[userMessageIndices.length - userTurnCount];\n  return messages.slice(startIndex);\n}\nconst POST = async ({ request, locals }) => {\n  const { session, user } = await locals.safeGetSession();\n  if (!session || !user) {\n    return json({ error: \"Unauthorized\" }, { status: 401 });\n  }\n  const { messages } = await request.json();\n  if (!messages || !Array.isArray(messages)) {\n    return json({ error: \"Invalid messages format\" }, { status: 400 });\n  }\n  let projectId;\n  let planMode = false;\n  for (let i = messages.length - 1; i >= 0; i--) {\n    const metadata = messages[i]?.metadata;\n    if (metadata?.projectId && !projectId) {\n      projectId = metadata.projectId;\n    }\n    if (metadata?.planMode !== void 0 && planMode === false) {\n      planMode = metadata.planMode;\n    }\n    if (projectId && planMode !== false) break;\n  }\n  console.log(\"=== CHAT API DEBUG ===\");\n  console.log(\"Extracted projectId from messages:\", projectId);\n  console.log(\"Extracted planMode from messages:\", planMode);\n  if (!projectId) {\n    return json({ error: \"Missing projectId in message metadata\" }, { status: 400 });\n  }\n  const [project] = await db.select().from(projects).where(eq(projects.id, projectId)).limit(1);\n  if (!project) {\n    return json({ error: \"Project not found\" }, { status: 404 });\n  }\n  if (project.userId !== user.id) {\n    return json({ error: \"Unauthorized\" }, { status: 403 });\n  }\n  const projectFiles = await db.select({\n    path: files.path\n  }).from(files).where(eq(files.projectId, projectId));\n  const projectAssets = await db.select({\n    filename: assets.filename,\n    fileType: assets.fileType,\n    assetType: assets.assetType,\n    sizeBytes: assets.sizeBytes,\n    metadata: assets.metadata\n  }).from(assets).where(eq(assets.projectId, projectId));\n  const dynamicSystemPrompt = buildSystemPrompt(projectFiles, projectAssets, planMode);\n  const tools = createProjectTools(projectId, planMode);\n  try {\n    const recentMessages = getRecentMessagesByUserTurns(messages, 5);\n    console.log(`üìä Message count: ${messages.length} total, sending last ${recentMessages.length} to model (${recentMessages.filter((m) => m.role === \"user\").length} user turns)`);\n    const result = streamText({\n      model: anthropic(\"claude-haiku-4-5\"),\n      system: dynamicSystemPrompt,\n      messages: convertToModelMessages(recentMessages),\n      tools,\n      stopWhen: stepCountIs(5),\n      // Allow up to 5 steps for multi-step tool calls\n      temperature: 0.7\n    });\n    return result.toUIMessageStreamResponse();\n  } catch (error) {\n    console.error(\"Chat API error:\", error);\n    return json(\n      {\n        error: \"Failed to generate response\",\n        details: error instanceof Error ? error.message : String(error)\n      },\n      { status: 500 }\n    );\n  }\n};\nexport {\n  POST\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;AASA,MAAM,gBAAgB,GAAG;AACzB;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,CAAC;AACD,MAAM,aAAa,GAAG,CAAC;;AAEvB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA,EAAE,gBAAgB,CAAC,CAAC;AACpB,MAAM,eAAe,GAAG,CAAC;;AAEzB;AACA;AACA;AACA;;AAEA,sDAAsD,CAAC;AACvD,SAAS,iBAAiB,CAAC,YAAY,EAAE,aAAa,GAAG,EAAE,EAAE,QAAQ,GAAG,KAAK,EAAE;AAC/E,EAAE,MAAM,eAAe,G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"}